
<main x-data="{
  theme: localStorage.getItem('theme') || 'light',
  view: 'list', // 'list' atau 'article'
  articles: [],
  currentArticle: null,
  isLoading: true,

  // Fungsi untuk mengambil semua artikel dari API Rails
  getArticles() {
      this.isLoading = true;
      fetch('/api/v1/articles')
          .then(response => response.json())
          .then(data => {
              this.articles = data;
              this.isLoading = false;
          })
          .catch(error => {
              console.error('Error fetching articles:', error);
              this.isLoading = false;
              // Anda bisa menambahkan state untuk menampilkan pesan error di UI
          });
  },

  // Fungsi untuk mengambil satu artikel berdasarkan slug
  getArticle(slug) {
      this.isLoading = true;
      this.currentArticle = null; // Kosongkan dulu artikel sebelumnya
      fetch(`/api/v1/articles/${slug}`)
          .then(response => response.json())
          .then(data => {
              this.currentArticle = data;
              this.view = 'article';
              this.isLoading = false;
              window.scrollTo(0, 0); // Otomatis scroll ke atas halaman
          })
          .catch(error => {
              console.error('Error fetching article:', error);
              this.isLoading = false;
          });
  },

  // Helper untuk memformat tanggal ke format Indonesia
  formatDate(dateString) {
      if (!dateString) return '';
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return new Date(dateString).toLocaleDateString('id-ID', options);
  },

  init() {
      this.$watch('theme', val => localStorage.setItem('theme', val));
      if (this.theme === 'dark') {
          document.documentElement.classList.add('dark');
      }
      this.getArticles(); // Panggil fungsi untuk mengambil data saat halaman dimuat
  }
}" x-init="init()">

    <!-- Indikator Loading -->
    <div x-show="isLoading" class="text-center py-16">
        <p class="text-gray-500 dark:text-gray-400">Memuat tulisan...</p>
    </div>

    <!-- VIEW: DAFTAR ARTIKEL (HOMEPAGE) -->
    <div x-show="!isLoading && view === 'list'" x-transition>
        <p class="text-center text-lg mb-16 text-gray-600 dark:text-gray-400">
            Catatan, ide, dan eksplorasi tentang teknologi, desain, dan produktivitas.
        </p>
        <div class="space-y-10">
            <!-- Template untuk setiap artikel dari API -->
            <template x-for="article in articles" :key="article.slug">
                <article>
                    <a :href="`/articles/${article.slug}`" class="group">
                        <h2 x-text="article.title" class="text-2xl md:text-3xl font-bold text-brand-dark dark:text-white group-hover:text-brand-accent dark:group-hover:text-brand-accent transition-colors"></h2>
                        <p x-text="article.lead" class="mt-2 text-gray-600 dark:text-gray-400"></p>
                        <time x-text="formatDate(article.published_at)" class="text-sm text-gray-500 dark:text-gray-500 mt-3 block"></time>
                    </a>
                </article>
            </template>
        </div>
    </div>

</main>
